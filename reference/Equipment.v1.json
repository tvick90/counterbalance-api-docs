{
  "openapi": "3.0.0",
  "info": {
    "title": "Equipment",
    "version": "1.0",
    "description": "## Defining Equipment Nodes\nEquipment nodes are the Counterbalance representation of the physical pieces of equipment on a site. \n\n### Equipment & Marker Tags\nEquipment nodes are defined using a top-level equipment tag and a variety of marker tags. \n\n### Parent/Child Relationships\nEquipment nodes can be defined to create a parent/child relationship that follows-that of the actual equipment onsite. Examples include an air handler that serves multiple VAV boxes or zones or chilled water plant and its associated chillers, pumps, cooling towers, etc.\n\n#### Permitted Relationships\nThe permitted parent/child components for each type of equipment are listed below.\n\n| Parent Tag | Permitted Children Tags |\n|---|---|\n| `ahu` | `vav`, `zone` |"
  },
  "servers": [
    {
      "url": "http://localhost:3000"
    }
  ],
  "paths": {
    "/v1/equipment": {
      "get": {
        "summary": "List Equipment Nodes",
        "tags": [
          "Equipment"
        ],
        "responses": {},
        "operationId": "list-equipment",
        "description": ""
      },
      "post": {
        "summary": "Create Equipment Node",
        "operationId": "create-equipment",
        "responses": {
          "201": {
            "description": "Created"
          }
        },
        "description": "",
        "tags": [
          "Equipment"
        ],
        "security": [
          {
            "Bearer Token": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "A name for the new node"
                  },
                  "description": {
                    "type": "string",
                    "description": "A brief description of the equipment"
                  },
                  "tag": {
                    "type": "string",
                    "description": "A top-level Haystack equipment tag"
                  },
                  "markers": {
                    "type": "string",
                    "description": "A space-seperated list of marker tags"
                  },
                  "@parent": {
                    "type": "string",
                    "description": "The parent equipment node of this node",
                    "format": "uuid"
                  },
                  "@site": {
                    "type": "string",
                    "format": "uuid"
                  },
                  "metadata": {
                    "type": "object"
                  },
                  "notes": {
                    "type": "string"
                  }
                },
                "required": [
                  "name",
                  "tag"
                ]
              },
              "examples": {
                "Example": {
                  "value": {
                    "name": "string",
                    "description": "string",
                    "tag": "string",
                    "markers": "string",
                    "@parent": "fedbb5a3-e076-44dc-92b5-6f9f6cec4ddc",
                    "@site": "451f769d-1122-4c11-a645-7d2ed505aa0b",
                    "metadata": {},
                    "notes": "string"
                  }
                }
              }
            }
          },
          "description": ""
        }
      }
    },
    "/v1/equipment/node/{nodeId}": {
      "parameters": [
        {
          "$ref": "#/components/parameters/nodeId"
        }
      ],
      "get": {
        "summary": "Get Equipment Node",
        "tags": [
          "Equipment"
        ],
        "responses": {},
        "operationId": "get-equipment-node",
        "description": "Retrieve equipment details",
        "security": [
          {
            "Bearer Token": []
          }
        ]
      },
      "patch": {
        "summary": "Update Equipment Node",
        "operationId": "update-equipment-node",
        "responses": {
          "200": {
            "description": "OK"
          }
        },
        "tags": [
          "Equipment Nodes"
        ],
        "description": "",
        "security": [
          {
            "Bearer Token": []
          }
        ]
      },
      "delete": {
        "summary": "Delete Equipment Node",
        "operationId": "delete-equipment-node",
        "responses": {
          "200": {
            "description": "OK"
          }
        },
        "description": "",
        "security": [
          {
            "Bearer Token": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "Equipment-Node-Object": {
        "description": "",
        "type": "object",
        "x-examples": {},
        "properties": {
          "id": {
            "type": "string",
            "minLength": 1
          },
          "name": {
            "type": "string",
            "minLength": 1
          },
          "description": {
            "type": "string",
            "minLength": 1
          },
          "@site": {
            "type": "string",
            "minLength": 1
          },
          "@floor": {},
          "@room": {},
          "@parent": {},
          "references": {
            "type": "object",
            "properties": {
              "": {
                "type": "object"
              }
            }
          },
          "haystack": {
            "type": "object",
            "required": [
              "equipment",
              "marker",
              "available_references"
            ],
            "properties": {
              "equipment": {
                "type": "object",
                "required": [
                  "tag",
                  "name",
                  "description",
                  "parent_ref",
                  "permitted_children_equipment"
                ],
                "properties": {
                  "tag": {
                    "type": "string",
                    "minLength": 1
                  },
                  "name": {
                    "type": "string",
                    "minLength": 1
                  },
                  "description": {
                    "type": "string",
                    "minLength": 1
                  },
                  "parent_ref": {
                    "type": "string",
                    "minLength": 1
                  },
                  "permitted_children_equipment": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              },
              "marker": {
                "type": "object",
                "required": [
                  "tags",
                  "tags_string",
                  "tag_definitions"
                ],
                "properties": {
                  "tags": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "tags_string": {
                    "type": "string",
                    "minLength": 1
                  },
                  "tag_definitions": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/Tag-Definition-Object"
                    }
                  }
                }
              },
              "available_references": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "metadata": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "telemetry": {
            "type": "object",
            "required": [
              "relationship_count",
              "base",
              "via_markers",
              "all"
            ],
            "properties": {
              "relationship_count": {
                "type": "number"
              },
              "base": {
                "type": "array",
                "items": {
                  "type": "object"
                }
              },
              "via_markers": {
                "type": "array",
                "items": {
                  "type": "object"
                }
              },
              "all": {
                "type": "array",
                "items": {
                  "type": "object"
                }
              }
            }
          }
        },
        "required": [
          "id",
          "name",
          "description",
          "@site",
          "references",
          "haystack",
          "metadata",
          "telemetry"
        ],
        "title": "Equipment Node Object"
      },
      "Tag-Definition-Object": {
        "description": "",
        "type": "object",
        "x-examples": {},
        "properties": {
          "id": {
            "type": "string",
            "minLength": 1
          },
          "name": {
            "type": "string",
            "minLength": 1
          },
          "description": {
            "type": "string",
            "minLength": 1
          },
          "references": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "telemetry": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "id",
          "name",
          "description",
          "references",
          "telemetry"
        ],
        "title": "Tag Definition Object"
      }
    },
    "securitySchemes": {
      "Bearer Token": {
        "type": "http",
        "scheme": "bearer"
      }
    },
    "parameters": {
      "nodeId": {
        "name": "nodeId",
        "in": "path",
        "required": true,
        "schema": {
          "type": "string",
          "format": "uuid"
        },
        "description": "A valid equipment node UUID"
      },
      "@ref": {
        "name": "@ref",
        "in": "query",
        "schema": {
          "type": "string",
          "format": "uuid",
          "example": "74c8d53f-d657-49ab-8240-532645628839"
        },
        "description": "Filter results by their parent or dependent node UUID"
      },
      "@siteId": {
        "name": "@site",
        "in": "query",
        "required": false,
        "schema": {
          "type": "string",
          "format": "uuid",
          "example": "0fa60c71-a611-418a-93a0-0bdf2dfa5ac3"
        },
        "description": "Filter results by their associated site UUID"
      },
      "tag": {
        "name": "tag",
        "in": "query",
        "required": false,
        "schema": {
          "type": "string"
        },
        "description": "Filter results by their Haystack equipment tag"
      }
    }
  },
  "tags": [
    {
      "name": "Equipment"
    },
    {
      "name": "Classifications"
    },
    {
      "name": "Components"
    }
  ]
}